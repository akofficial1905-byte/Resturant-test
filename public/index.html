<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Titishya Fast Food — Order</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .menu-cat { font-size:1.5rem; font-weight:800; color:#d97706; margin-top:2rem; letter-spacing:0.5px;}
    .item-name { font-size:1.13em; font-weight:700; }
    .item-variant { font-size:1em; color:#92400e; margin-left:7px;}
    .item-price { font-weight:600; color:#059669;}
    .add-btn { background:#34d399; color:#222; font-weight:bold; border-radius:7px; }
    .qty-btn { background:#d1fae5; color:#059669; padding:2px 9px;font-weight:bold; border-radius:30px;}
    .cart-total { color:#b91c1c;font-weight:900; font-size:1.4em;}
    @media (max-width:768px){
      aside { display:none; }
      #mobile-cart-bar { display:flex !important; }
    }
  </style>
</head>
<body class="bg-yellow-50 text-gray-800 min-h-screen">
  <div class="max-w-xl mx-auto px-3 pt-5 pb-24">
    <h1 class="text-3xl font-extrabold text-center text-yellow-900 mb-3 tracking-widest">Titishya Fast Food</h1>
    <div class="text-sm text-gray-500 text-center mb-6">Fresh, Fast, and Hygienic Food<br><b>Order below &rarr;</b></div>
    <form id="orderForm" class="mb-4">
      <div id="menu"></div>
      <div class="fixed bottom-0 left-0 w-full bg-yellow-900 text-white px-4 py-3 flex justify-between shadow-xl">
        <span class="cart-total" id="cartTotal">₹0</span>
        <button type="submit" class="bg-green-400 text-black font-bold px-6 py-2 rounded hover:bg-green-500 shadow-lg">Place Order</button>
      </div>
      <div class="mb-5">&nbsp;</div>
      <div id="cartMsg" class="mt-3 text-md"></div>
    </form>
  </div>
  <script>
    let menuData=[], cart={};
    // Fetch menu.json via API
    fetch('/menu.json')
      .then(r=>r.json())
      .then(data => {
        menuData = data;
        renderMenu();
      });

    function renderMenu() {
      let html = '';
      Object.entries(menuData).forEach(([category, items]) => {
        html += `<div class="menu-cat">${category}</div>`;
        html += '<div class="mb-3">';
        items.forEach((it,idx) => {
          if(it.variants && typeof it.variants === 'object') {
            Object.entries(it.variants).forEach(([variant, price]) => {
              const key = category+'_'+idx+'_'+variant;
              html += `
                <div class="flex justify-between border-b py-1 items-center">
                  <span>
                    <span class="item-name">${it.name} </span>
                    <span class="item-variant">${variant}</span>
                  </span>
                  <span>
                    <span class="item-price">₹${price}</span>
                    <button type="button" class="add-btn px-3 py-1 ml-3" onclick="addCart('${key}','${it.name}','${variant}',${price})">Add</button>
                  </span>
                </div>
              `;
            });
          } else if(it.variants && Array.isArray(it.variants)) {
            // In case menu.json uses array of objects, e.g. "variants": [{name:...,price:...}]
            it.variants.forEach(variant => {
              const key = category+'_'+idx+'_'+variant.name;
              html += `
                <div class="flex justify-between border-b py-1 items-center">
                  <span>
                    <span class="item-name">${it.name} </span>
                    <span class="item-variant">${variant.name}</span>
                  </span>
                  <span>
                    <span class="item-price">₹${variant.price}</span>
                    <button type="button" class="add-btn px-3 py-1 ml-3" onclick="addCart('${key}','${it.name}','${variant.name}',${variant.price})">Add</button>
                  </span>
                </div>
              `;
            });
          } else {
            const key = category+'_'+idx+'_base';
            html += `
              <div class="flex justify-between border-b py-1 items-center">
                <span class="item-name">${it.name}</span>
                <span>
                  <span class="item-price">₹${it.price}</span>
                  <button type="button" class="add-btn px-3 py-1 ml-3" onclick="addCart('${key}','${it.name}','',${it.price})">Add</button>
                </span>
              </div>
            `;
          }
        });
        html += '</div>';
      });
      document.getElementById('menu').innerHTML = html;
    }

    function addCart(key, name, variant, price) {
      if(!cart[key]) cart[key]={name,variant,price,qty:0};
      cart[key].qty += 1;
      updateCartTotal();
    }

    function updateCartTotal() {
      let t = 0, items = [];
      Object.keys(cart).forEach(k=>{
        const it = cart[k];
        if(it.qty>0) {
          t += it.price*it.qty;
          items.push(`${it.name}${it.variant?' ('+it.variant+')':''} x${it.qty}`);
        }
      });
      document.getElementById('cartTotal').textContent = '₹'+t;
    }

    document.getElementById('orderForm').onsubmit = async function(e) {
      e.preventDefault();
      let items = Object.values(cart).filter(it=>it.qty>0);
      if(items.length===0) {
        alert("Please add at least one item");
        return;
      }
      let name = prompt("Your Name:");
      if(!name) return;
      let mobile = prompt("Mobile (optional):");
      let orderType = prompt("Dining type? (dinein/takeaway/delivery):",'dinein');
      let tableNumber = '';
      let address = '';
      if(orderType==='dinein') tableNumber = prompt("Table Number:");
      if(orderType==='delivery' || orderType==='takeaway') address = prompt("Address:");
      let total = items.reduce((s,it)=>s+it.price*it.qty,0);
      // API call
      let res = await fetch('/api/orders', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({
          items, total, customerName: name, mobile, orderType, tableNumber, address
        })
      });
      if(res.ok) {
        cart = {}; updateCartTotal();
        document.getElementById('cartMsg').textContent = "Order placed! You'll be served soon.";
      } else {
        document.getElementById('cartMsg').textContent = "Order failed. Try again.";
      }
    }
  </script>
</body>
</html>


